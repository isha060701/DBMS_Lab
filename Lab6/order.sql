create database order_db;
use order_db;

CREATE TABLE SALESMAN
(SALESMAN_ID int,
NAME VARCHAR (20),
CITY VARCHAR (20),
COMMISSION VARCHAR (20),
PRIMARY KEY (SALESMAN_ID));

CREATE TABLE CUSTOMER
(CUSTOMER_ID int,
CUST_NAME VARCHAR (20),
CITY VARCHAR (20),
GRADE int,
PRIMARY KEY (CUSTOMER_ID),
SALESMAN_ID INT,
FOREIGN KEY(SALESMAN_ID) REFERENCES SALESMAN (SALESMAN_ID));

CREATE TABLE ORDERS
(ORD_NO INT,
PURCHASE_AMT INT,
ORD_DATE DATE,
PRIMARY KEY (ORD_NO),
CUSTOMER_ID INT,
SALESMAN_ID INT,
FOREIGN KEY(CUSTOMER_ID) REFERENCES CUSTOMER (CUSTOMER_ID) ,
FOREIGN KEY(SALESMAN_ID) REFERENCES SALESMAN (SALESMAN_ID));

INSERT INTO SALESMAN VALUES (1000, 'JOHN','BANGALORE','25 %');
INSERT INTO SALESMAN VALUES (2000, 'RAVI','BANGALORE','20 %');
INSERT INTO SALESMAN VALUES (3000, 'KUMAR','MYSORE','15 %');
INSERT INTO SALESMAN VALUES (4000, 'SMITH','DELHI','30 %');
INSERT INTO SALESMAN VALUES (5000, 'HARSHA','HYDRABAD','15 %');
SELECT * FROM SALESMAN;

INSERT INTO CUSTOMER VALUES 
(10, 'PREETHI','BANGALORE', 100, 1000),
(11, 'VIVEK','MANGALORE', 300, 1000),
(12, 'BHASKAR','CHENNAI', 400, 2000),
(13, 'CHETHAN','BANGALORE', 200, 2000),
(14, 'MAMATHA','BANGALORE', 400, 3000);
SELECT * FROM CUSTOMER;

INSERT INTO ORDERS VALUES 
(50, 5000, '04-05-17', 10, 1000),
(51, 450, '20-01-17', 10, 2000),
(52, 1000, '24-02-17', 13, 2000),
(53, 3500, '13-04-17', 14, 3000),
(54, 550, '09-03-17', 12, 2000);
SELECT * FROM ORDERS;

SELECT GRADE,COUNT(DISTINCT CUSTOMER_ID)
FROM CUSTOMER
GROUP BY GRADE
HAVING GRADE>(SELECT AVG(GRADE)
FROM CUSTOMER
WHERE CITY='BANGALORE');

SELECT NAME,SALESMAN_ID
FROM SALESMAN
WHERE SALESMAN_ID IN
(SELECT SALESMAN_ID
FROM CUSTOMER 
GROUP BY SALESMAN_ID
HAVING COUNT(DISTINCT CUSTOMER_ID)>1);

SELECT SALESMAN.SALESMAN_ID, NAME, CUST_NAME, COMMISSION
FROM SALESMAN, CUSTOMER
WHERE SALESMAN.CITY = CUSTOMER.CITY
UNION
SELECT SALESMAN_ID, NAME, 'NO MATCH', COMMISSION
FROM SALESMAN
WHERE NOT CITY = ANY
(SELECT CITY
FROM CUSTOMER);

CREATE VIEW HIGHEST_ORDER AS
SELECT distinct S.NAME,C.ORD_DATE
FROM SALESMAN S,ORDERS C
WHERE S.SALESMAN_ID=C.SALESMAN_ID
AND C.PURCHASE_AMT=(SELECT MAX(PURCHASE_AMT)
FROM ORDERS
WHERE C.ORD_DATE=ORD_DATE);
SELECT * FROM HIGHEST_ORDER;
